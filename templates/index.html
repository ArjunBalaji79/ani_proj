<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoodTunes - AI Song Recommendations</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            transition: background 1s ease;
        }

        .container {
            max-width: 800px;
            width: 100%;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .input-section {
            margin-bottom: 30px;
        }

        .input-section label {
            display: block;
            font-size: 1.1em;
            margin-bottom: 10px;
            color: #333;
            font-weight: 600;
        }

        .input-section textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        .input-section textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            text-align: center;
            padding: 20px;
            display: none;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results {
            margin-top: 30px;
            display: none;
        }

        .results.active {
            display: block;
        }

        .explanation {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .explanation h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .explanation p {
            color: #555;
            line-height: 1.6;
            white-space: pre-line;
        }

        .songs {
            display: grid;
            gap: 15px;
        }

        .song-card {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .song-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .song-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .song-artist {
            color: #666;
            margin-bottom: 10px;
        }

        .song-meta {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
        }

        .tag {
            display: inline-block;
            padding: 5px 10px;
            background: #667eea;
            color: white;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .song-description {
            color: #555;
            line-height: 1.5;
            margin-top: 10px;
        }

        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }

        .error.active {
            display: block;
        }

        .examples {
            margin-top: 15px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 8px;
        }

        .examples p {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
        }

        .example-tag {
            display: inline-block;
            padding: 5px 10px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.85em;
            margin: 3px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .example-tag:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        /* Weather Widget */
        .weather-widget {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 2px solid #e0e0e0;
        }

        .weather-emoji {
            font-size: 3em;
            line-height: 1;
        }

        .weather-info {
            flex: 1;
        }

        .weather-info h3 {
            margin: 0;
            font-size: 1.2em;
            color: #333;
        }

        .weather-info p {
            margin: 5px 0;
            color: #666;
            font-size: 0.95em;
        }

        .weather-btn {
            padding: 8px 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            transition: transform 0.2s;
        }

        .weather-btn:hover {
            transform: scale(1.05);
        }

        /* Time-based suggestions */
        .time-widget {
            background: #f0f4ff;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            text-align: center;
            border: 2px solid #d0d8ff;
        }

        .time-widget strong {
            color: #667eea;
            font-size: 1.1em;
        }

        /* Music Platform Links */
        .music-links {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .music-btn {
            display: inline-block;
            padding: 8px 15px;
            border-radius: 8px;
            text-decoration: none;
            font-size: 0.9em;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            border: 2px solid;
        }

        .music-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .music-btn.spotify {
            background: #1DB954;
            color: white;
            border-color: #1DB954;
        }

        .music-btn.youtube {
            background: #FF0000;
            color: white;
            border-color: #FF0000;
        }

        .music-btn.apple {
            background: #FA243C;
            color: white;
            border-color: #FA243C;
        }

        /* Playlist button */
        .playlist-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #1DB954 0%, #1ed760 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
            display: block;
            text-align: center;
        }

        .playlist-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(29, 185, 84, 0.4);
        }

        @media (max-width: 600px) {
            .weather-widget {
                flex-direction: column;
                text-align: center;
            }
            
            .music-links {
                flex-direction: column;
            }
            
            .music-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéµ MoodTunes</h1>
            <p>AI-powered song recommendations based on your mood</p>
        </div>
        
        <div class="content">
            <!-- Weather Widget -->
            <div class="weather-widget" id="weatherWidget"></div>
            
            <!-- Time-based Widget -->
            <div class="time-widget" id="timeWidget"></div>

            <div class="input-section">
                <label for="mood">How are you feeling today?</label>
                <textarea 
                    id="mood" 
                    placeholder="Describe your mood... (e.g., 'I'm feeling a bit down today' or 'Super happy and energetic!')"
                ></textarea>
                
                <div class="examples">
                    <p><strong>Try these:</strong></p>
                    <span class="example-tag" onclick="setExample('I\'m feeling really happy and energetic today!')">üòä Happy & Energetic</span>
                    <span class="example-tag" onclick="setExample('Feeling a bit sad and need some comfort')">üò¢ Sad & Need Comfort</span>
                    <span class="example-tag" onclick="setExample('I\'m stressed out and anxious about work')">üò∞ Stressed & Anxious</span>
                    <span class="example-tag" onclick="setExample('Feeling nostalgic and reflective')">üåÖ Nostalgic</span>
                    <span class="example-tag" onclick="setExample('Ready to party and have fun!')">üéâ Party Mode</span>
                </div>
            </div>

            <button class="button" onclick="getRecommendations()">
                Get Song Recommendations
            </button>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p style="margin-top: 10px; color: #666;">Finding perfect songs for you...</p>
            </div>

            <div class="error" id="error"></div>

            <div class="results" id="results">
                <div class="explanation" id="explanation">
                    <h3>üéØ Personalized Recommendations</h3>
                    <p id="explanationText"></p>
                </div>

                <div class="songs" id="songs"></div>
            </div>
        </div>
    </div>

    <script>
        // Mood-based color gradients
        const moodGradients = {
            happy: ['#FFD93D', '#F7B32B'],
            sad: ['#4A5568', '#667EEA'],
            energetic: ['#FF6B6B', '#FFA500'],
            calm: ['#667eea', '#764ba2'],
            anxious: ['#8B7355', '#6B5B95'],
            excited: ['#FF6B9D', '#FFA500'],
            melancholic: ['#5C7AEA', '#2D3561'],
            nostalgic: ['#F093FB', '#F5576C'],
            party: ['#FA8BFF', '#2BD2FF'],
            motivated: ['#FF512F', '#DD2476'],
            peaceful: ['#00B4DB', '#0083B0'],
            romantic: ['#FF758C', '#FF7EB3']
        };

        // Weather moods (rotates daily)
        const weatherMoods = [
            {weather: 'Sunny', emoji: '‚òÄÔ∏è', suggestion: 'happy and energetic', colors: ['#FFD93D', '#F7B32B']},
            {weather: 'Rainy', emoji: 'üåßÔ∏è', suggestion: 'calm and reflective', colors: ['#4682B4', '#667eea']},
            {weather: 'Cloudy', emoji: '‚òÅÔ∏è', suggestion: 'mellow and thoughtful', colors: ['#B0C4DE', '#889FC9']},
            {weather: 'Partly Cloudy', emoji: '‚õÖ', suggestion: 'balanced and content', colors: ['#87CEEB', '#6AAFF2']},
            {weather: 'Stormy', emoji: '‚õàÔ∏è', suggestion: 'intense and powerful', colors: ['#483D8B', '#7B68AC']},
            {weather: 'Clear Night', emoji: 'üåô', suggestion: 'peaceful and contemplative', colors: ['#2C3E50', '#3498DB']},
            {weather: 'Breezy', emoji: 'üçÉ', suggestion: 'carefree and light', colors: ['#56CCF2', '#2F80ED']}
        ];

        // Initialize weather widget
        function initWeatherWidget() {
            const dayIndex = new Date().getDay() % weatherMoods.length;
            const weather = weatherMoods[dayIndex];
            
            document.getElementById('weatherWidget').innerHTML = `
                <div class="weather-emoji">${weather.emoji}</div>
                <div class="weather-info">
                    <h3>Today: ${weather.weather}</h3>
                    <p>Perfect mood: <em>${weather.suggestion}</em></p>
                </div>
                <button class="weather-btn" onclick="setExample('I\'m feeling ${weather.suggestion}')">
                    Try this mood
                </button>
            `;
        }

        // Initialize time-based widget
        function initTimeWidget() {
            const hour = new Date().getHours();
            let timeMessage = '';
            let timeMood = '';
            
            if (hour >= 5 && hour < 12) {
                timeMessage = '‚òÄÔ∏è Good Morning! Start your day right';
                timeMood = 'motivated and ready to conquer the day';
            } else if (hour >= 12 && hour < 17) {
                timeMessage = '‚òï Good Afternoon! Keep that energy up';
                timeMood = 'productive and focused';
            } else if (hour >= 17 && hour < 21) {
                timeMessage = 'üåÖ Good Evening! Time to unwind';
                timeMood = 'relaxed and winding down';
            } else {
                timeMessage = 'üåô Good Night! Late night vibes';
                timeMood = 'peaceful and contemplative';
            }
            
            document.getElementById('timeWidget').innerHTML = `
                <strong>${timeMessage}</strong>
                <p style="margin-top: 5px;">
                    <a href="#" onclick="setExample('I\'m feeling ${timeMood}'); return false;" 
                       style="color: #667eea; text-decoration: none; font-weight: 600;">
                        Try: "${timeMood}"
                    </a>
                </p>
            `;
        }

        // Detect mood from text and apply gradient
        function applyMoodGradient(moodText) {
            const text = moodText.toLowerCase();
            
            for (const [mood, colors] of Object.entries(moodGradients)) {
                if (text.includes(mood)) {
                    document.body.style.background = `linear-gradient(135deg, ${colors[0]} 0%, ${colors[1]} 100%)`;
                    return;
                }
            }
            
            // Default gradient if no mood detected
            document.body.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
        }

        // Create music platform links
        function createMusicLinks(song) {
            const query = encodeURIComponent(`${song.title} ${song.artist}`);
            return `
                <div class="music-links">
                    <a href="https://open.spotify.com/search/${query}" target="_blank" class="music-btn spotify">
                        üéµ Spotify
                    </a>
                    <a href="https://music.youtube.com/search?q=${query}" target="_blank" class="music-btn youtube">
                        ‚ñ∂Ô∏è YouTube Music
                    </a>
                    <a href="https://music.apple.com/us/search?term=${query}" target="_blank" class="music-btn apple">
                        üéß Apple Music
                    </a>
                </div>
            `;
        }

        // Create playlist URL for all songs
        function createPlaylistLink(songs) {
            const query = songs.map(s => `${s.title} ${s.artist}`).join(' ');
            return `https://open.spotify.com/search/${encodeURIComponent(query)}`;
        }

        function setExample(text) {
            document.getElementById('mood').value = text;
            applyMoodGradient(text);
        }

        async function getRecommendations() {
            const mood = document.getElementById('mood').value.trim();
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            const error = document.getElementById('error');
            const button = document.querySelector('.button');

            if (!mood) {
                showError('Please describe your mood first!');
                return;
            }

            // Apply gradient based on mood
            applyMoodGradient(mood);

            // Show loading, hide results and errors
            loading.classList.add('active');
            results.classList.remove('active');
            error.classList.remove('active');
            button.disabled = true;

            try {
                const response = await fetch('/api/recommend', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ mood: mood })
                });

                if (!response.ok) {
                    throw new Error('Failed to get recommendations');
                }

                const data = await response.json();
                displayResults(data);
            } catch (err) {
                showError('Oops! Something went wrong. Please try again.');
                console.error(err);
            } finally {
                loading.classList.remove('active');
                button.disabled = false;
            }
        }

        function displayResults(data) {
            const results = document.getElementById('results');
            const explanationText = document.getElementById('explanationText');
            const songsContainer = document.getElementById('songs');

            // Display explanation
            explanationText.textContent = data.explanation;

            // Display songs with music links
            songsContainer.innerHTML = '';
            data.recommendations.forEach(song => {
                const songCard = document.createElement('div');
                songCard.className = 'song-card';
                songCard.innerHTML = `
                    <div class="song-title">${song.title}</div>
                    <div class="song-artist">by ${song.artist}</div>
                    <div class="song-meta">
                        <span class="tag">${song.genre}</span>
                    </div>
                    <div class="song-description">${song.description}</div>
                    ${createMusicLinks(song)}
                `;
                songsContainer.appendChild(songCard);
            });

            // Add "Open All in Spotify" button
            const playlistBtn = document.createElement('a');
            playlistBtn.href = createPlaylistLink(data.recommendations);
            playlistBtn.target = '_blank';
            playlistBtn.className = 'playlist-btn';
            playlistBtn.innerHTML = 'üéµ Open All Songs in Spotify';
            songsContainer.appendChild(playlistBtn);

            results.classList.add('active');
        }

        function showError(message) {
            const error = document.getElementById('error');
            error.textContent = message;
            error.classList.add('active');
        }

        // Initialize widgets on page load
        document.addEventListener('DOMContentLoaded', function() {
            initWeatherWidget();
            initTimeWidget();
        });

        // Allow Enter key to submit (with Shift+Enter for new line)
        document.getElementById('mood').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                getRecommendations();
            }
        });
    </script>
</body>
</html>
